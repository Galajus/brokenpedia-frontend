<div class="restrict-width" style="padding-bottom: 15px">
  <mat-card>
    <mat-card-content>
      <div fxLayout="column">
        <div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="4" style="padding-bottom: 15px">
          <div *ngFor="let userRars of userRarsWithDrifs">
            <button *ngIf="activeBuild === userRars.name" style="width: 80px" mat-flat-button color="primary"
                    (click)="setActiveBuild(userRars.name)">
              {{ userRars.name }}
            </button>
            <button *ngIf="activeBuild !== userRars.name" style="width: 80px" mat-flat-button color="accent"
                    (click)="setActiveBuild(userRars.name)">
              {{ userRars.name }}
            </button>
          </div>

        </div>
        <div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="1" cdkDropListGroup>
          <div *ngFor="let eq of getActiveBuild()?.rarsWithDrifs">
            <div class="circle" fxLayoutAlign="center center" style="margin-bottom: 8px">
              <img src="assets/equipment/placeholders/{{eq.slot.toLocaleLowerCase()}}.png" alt="{{eq.slot}}">
              <div *ngIf="eq.rank <= 12" class="capacity">{{ printUsedCapacity(eq) }}</div>
            </div>
            <div fxLayout="column" fxLayoutAlign="space-between" style="padding-bottom: 2px">
              <div fxLayout="row" fxLayoutAlign="space-evenly center">
                <div>
                  <p class="sidraga">+15%</p>
                  <mat-checkbox [(ngModel)]="eq.sidragaBoost" (change)="calculateModSummary()"></mat-checkbox>
                </div>
                <div *ngIf="eq.slot === InventorySlot.WEAPON">
                  <p class="sidraga">+60%</p>
                  <mat-checkbox [(ngModel)]="eq.epikBoost" (change)="calculateModSummary()"></mat-checkbox>
                </div>
              </div>

            </div>
            <div>
              <mat-form-field style="width: 70px" appearance="fill" color="accent">
                <mat-label>Stars</mat-label>
                <mat-select [(ngModel)]="eq.ornaments" (selectionChange)="calculateModSummary()">
                  <mat-option [value]=1>1* - Bronze 1</mat-option>
                  <mat-option [value]=2>2* - Bronze 2</mat-option>
                  <mat-option [value]=3>3* - Bronze 3</mat-option>
                  <mat-option [value]=4>4* - Silver 1</mat-option>
                  <mat-option [value]=5>5* - Silver 2</mat-option>
                  <mat-option [value]=6>6* - Silver 3</mat-option>
                  <mat-option [value]=7>7* - Gold 1</mat-option>
                  <mat-option [value]=8>8* - Gold 2</mat-option>
                  <mat-option [value]=9>9* - Gold 3</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field style="width: 70px" appearance="fill" color="accent">
                <mat-label>Ranga</mat-label>
                <mat-select [(ngModel)]="eq.rank" (selectionChange)="calculateModSummary()">
                  <mat-option *ngFor="let number of Array.from(Array(11).keys())" [value]="number + 2">{{ (number + 2) | arabian }}</mat-option>
                  <div *ngIf="eq.slot === InventorySlot.WEAPON">
                    <mat-option *ngFor="let epic of epicsMods" [value]="epic.id + 12">{{epic.epicName}}</mat-option>
                  </div>
                </mat-select>
              </mat-form-field>
              <div *ngIf="eq.rank > 12" fxLayout="column" fxLayoutAlign="center center">
                <mat-form-field style="width: 70px" color="accent">
                  <mat-label>Krytyk</mat-label>
                  <mat-select [(ngModel)]="getActiveBuild().critEpicModLevel" (selectionChange)="calculateModSummary()">
                    <mat-option *ngFor="let number of Array.from(Array(16).keys())" [value]="number + 1">{{ (number + 1) }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field style="width: 70px" color="accent">
                  <mat-label>Dedyk.</mat-label>
                  <mat-select [(ngModel)]="getActiveBuild().dedicatedEpicModLevel"
                              (selectionChange)="calculateModSummary()">
                    <mat-option *ngFor="let number of Array.from(Array(16).keys())" [value]="number + 1">{{ (number + 1) }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div *ngIf="eq.rank <= 12" fxLayout="column" fxLayoutAlign="center center"
                   cdkDropList
                   cdkDropListLockAxis="y"
                   [cdkDropListData]=" getDragDrifItemArray(eq)"
                   (cdkDropListDropped)="drop($event, eq.slot)">
                <button *ngIf="!eq.drifItem1 && countUsedPower(eq) !== getPowerCapacityByRank(eq)"
                        style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button class="emptySlot"
                        (click)="openDrifDialog( eq, 1)"
                        cdkDrag>
                  [MOD 1]
                </button>
                <button *ngIf="!eq.drifItem1 && countUsedPower(eq) === getPowerCapacityByRank(eq)"
                        style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button [disabled]="true"
                        (click)="openDrifDialog( eq, 1)"
                        cdkDrag>
                  [MOD 1]
                </button>
                <button *ngIf="eq.drifItem1" style="width: 70px; margin-bottom: 8px; padding: 0"
                        [matBadge]="eq.drifItem1.level" matBadgeSize="small" matBadgeColor="primary"
                        [class]="getButtonColorClassByDrifCategory(eq.drifItem1)" mat-flat-button color="warn"
                        (click)="openDrifDialog( eq, 1)"
                        cdkDrag>
                  <div fxLayout="row" fxLayoutAlign="space-evenly center">
                    <div>
                      {{ eq.drifItem1.shortName }}
                    </div>
                    <div fxLayout="column">
                      <div class="tier-power" fxLayoutAlign="center center">
                        T{{ eq.drifItem1.tier }}
                      </div>
                      <div class="tier-power" fxLayoutAlign="center center">
                        P{{ drifService.getDrifPower(eq.drifItem1.startPower, eq.drifItem1.level || 1) }}
                      </div>
                    </div>
                  </div>
                </button>

                <button
                  *ngIf="(eq.rank > 3 || eq.ornaments >= 7) && !eq.drifItem2 && countUsedPower(eq) !== getPowerCapacityByRank(eq)"
                  style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button class="emptySlot"
                  (click)="openDrifDialog( eq, 2)"
                  cdkDrag>
                  [MOD 2]
                </button>
                <button
                  *ngIf="(eq.rank > 3 || eq.ornaments >= 7) && !eq.drifItem2 && countUsedPower(eq) === getPowerCapacityByRank(eq)"
                  style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button [disabled]="true"
                  (click)="openDrifDialog( eq, 2)"
                  cdkDrag>
                  [MOD 2]
                </button>
                <button *ngIf="(eq.rank > 3 || eq.ornaments >= 7) && eq.drifItem2"
                        style="width: 70px; margin-bottom: 8px; padding: 0"
                        [matBadge]="eq.drifItem2.level" matBadgeSize="small" matBadgeColor="primary"
                        [class]="getButtonColorClassByDrifCategory(eq.drifItem2)" mat-flat-button color="warn"
                        (click)="openDrifDialog( eq, 2)"
                        cdkDrag>
                  <div fxLayout="row" fxLayoutAlign="space-evenly center">
                    <div>
                      {{ eq.drifItem2.shortName }}
                    </div>
                    <div fxLayout="column">
                      <div class="tier-power" fxLayoutAlign="center center">
                        T{{ eq.drifItem2.tier }}
                      </div>
                      <div class="tier-power" fxLayoutAlign="center center">
                        P{{ drifService.getDrifPower(eq.drifItem2.startPower, eq.drifItem2.level || 1) }}
                      </div>
                    </div>
                  </div>
                </button>

                <button *ngIf="eq.rank > 9 && !eq.drifItem3 && countUsedPower(eq) !== getPowerCapacityByRank(eq)"
                        style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button class="emptySlot"
                        (click)="openDrifDialog( eq, 3)"
                        cdkDrag>
                  [MOD 3]
                </button>
                <button *ngIf="eq.rank > 9 && !eq.drifItem3 && countUsedPower(eq) === getPowerCapacityByRank(eq)"
                        style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button [disabled]="true"
                        (click)="openDrifDialog( eq, 3)"
                        cdkDrag>
                  [MOD 3]
                </button>
                <button *ngIf="eq.rank > 9 && eq.drifItem3" style="width: 70px; margin-bottom: 8px; padding: 0"
                        [matBadge]="eq.drifItem3.level" matBadgeSize="small" matBadgeColor="primary"
                        [class]="getButtonColorClassByDrifCategory(eq.drifItem3)" mat-flat-button color="warn"
                        (click)="openDrifDialog( eq, 3)"
                        cdkDrag>
                  <div fxLayout="row" fxLayoutAlign="space-evenly center">
                    <div>
                      {{ eq.drifItem3.shortName }}
                    </div>
                    <div fxLayout="column">
                      <div class="tier-power" fxLayoutAlign="center center">
                        T{{ eq.drifItem3.tier }}
                      </div>
                      <div class="tier-power" fxLayoutAlign="center center">
                        P{{ drifService.getDrifPower(eq.drifItem3.startPower, eq.drifItem3.level || 1) }}
                      </div>
                    </div>
                  </div>

                </button>
              </div>
            </div>
          </div>
        </div>

        <div fxLayout="column" fxLayoutAlign="center center">
          <ul>
            <li *ngFor="let mod of getModSummaryByCategory(modSummary, DrifCategory.DAMAGE)"
                class="damageDrifText">
              <div (mouseenter)="illuminateHoovered(mod)" (mouseleave)="clearIlluminated()"
                   [innerHTML]="prepareModSummaryRow(mod)"></div>
            </li>
            <li *ngFor="let mod of getModSummaryByCategory(modSummary, DrifCategory.SPECIAL)"
                class="specialDrifText">
              <div (mouseenter)="illuminateHoovered(mod)" (mouseleave)="clearIlluminated()"
                   [innerHTML]="prepareModSummaryRow(mod)"></div>
            </li>
            <li *ngFor="let mod of getModSummaryByCategory(modSummary, DrifCategory.DEFENCE)"
                class="defenceDrifText">
              <div (mouseenter)="illuminateHoovered(mod)" (mouseleave)="clearIlluminated()"
                   [innerHTML]="prepareModSummaryRow(mod)"></div>
            </li>
            <li *ngFor="let mod of getModSummaryByCategory(modSummary, DrifCategory.ACCURACY)"
                class="accuracyDrifText">
              <div (mouseenter)="illuminateHoovered(mod)" (mouseleave)="clearIlluminated()"
                   [innerHTML]="prepareModSummaryRow(mod)"></div>
            </li>
            <li *ngFor="let mod of getModSummaryByCategory(modSummary, DrifCategory.REDUCTION)"
                class="reductionDrifText">
              <div (mouseenter)="illuminateHoovered(mod)" (mouseleave)="clearIlluminated()"
                   [innerHTML]="prepareModSummaryRow(mod)"></div>
            </li>
          </ul>
        </div>
        <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="10">
          <button mat-flat-button color="warn"
                  (click)="resetBuild(activeBuild)">
            ZRESETUJ BUILD
          </button>
          <button mat-flat-button color="accent"
                  (click)="maximiseDrifLevels()">
            WYMAKSUJ LVLE DRIFÓW
          </button>
          <mat-form-field appearance="fill" color="accent" class="cloneForm">
            <mat-label>Sklonuj build</mat-label>
            <mat-select [(ngModel)]="buildToClone" (selectionChange)="cloneBuild()">
              <mat-option *ngFor="let name of buildNames" [value]="name">{{name}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          * +15% = Sidraga boost <br>
          * +60% = Epic v2 boost
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<!--
<div *ngFor="let dragDrif of eq.dragDrop"
     cdkDropList
     (cdkDropListEntered)="logEntered($event)"
     [cdkDropListData]="eq.dragDrop"
     (cdkDropListDropped)="drop($event)">
  <button *ngIf="!dragDrif.drif && countUsedPower(eq) !== getPowerCapacityByRank(eq)"
          style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button class="emptySlot"
          (click)="openDrifDialog( eq, dragDrif.fromSlot + 1)"
          cdkDrag>
    [MOD {{ dragDrif.fromSlot +1 }}]
  </button>
  <button *ngIf="!dragDrif.drif && countUsedPower(eq) >= getPowerCapacityByRank(eq)"
          style="width: 70px; margin-bottom: 8px; padding: 0" mat-flat-button [disabled]="true"
          (click)="openDrifDialog( eq, dragDrif.fromSlot + 1)"
          cdkDrag>
    [MOD {{ dragDrif.fromSlot +1 }}]
  </button>
  <button *ngIf="dragDrif.drif" style="width: 70px; margin-bottom: 8px; padding: 0"
          [matBadge]="dragDrif.drif.level" matBadgeSize="small" matBadgeColor="primary"
          [class]="getButtonColorClassByDrifCategory(dragDrif.drif)" mat-flat-button color="warn"
          (click)="openDrifDialog( eq, dragDrif.fromSlot + 1)"
          cdkDrag>
    <div fxLayout="row" fxLayoutAlign="space-evenly center">
      <div>
        {{ dragDrif.drif.shortName }}
      </div>
      <div fxLayout="column">
        <div class="tier-power" fxLayoutAlign="center center">
          T{{ dragDrif.drif.tier }}
        </div>
        <div class="tier-power" fxLayoutAlign="center center">
          P{{ drifService.getDrifPower(dragDrif.drif.startPower, dragDrif.drif.level || 1) }}
        </div>
      </div>
    </div>
  </button>
</div>-->
